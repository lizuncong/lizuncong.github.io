## APP 路由系统

### 渲染层级
app路由系统中，组件的渲染层级如下所示：

![image](../../../imgs/route_01.jpg)


![image](../../../imgs/route_02.jpg)


### 并行路由和拦截路由
- 并行路由：允许您在同一视图中同时显示两个或多个可独立导航的页面。您可以将它们用于具有独立子导航的拆分视图。例如，仪表板。
- 拦截路由 ：允许您拦截一条路由并将其显示在另一个路由的上下文中。当需要保留当前页面的上下文时，可以使用此功能。例如，在编辑某个任务时查看所有任务，或在动态中展开某张照片。

### Layout和Template
- Layout：布局是多个路由之间共享的 UI。导航时，布局会保留状态、保持交互性，并且不会重新渲染。布局也可以嵌套 
- Template：模板与布局类似，因为它们会封装每个子布局或页面。与跨路由持久化并维护状态的布局不同，模板会在导航时为每个子项创建一个新实例。这意味着，当用户在共享模板的路由之间导航时，会挂载该组件的新实例，重新创建 DOM 元素，状态不会保留，并且效果会重新同步。

### Linking and Navigating

#### Next.js 中有四种方式可以在路由之间导航
- 使用 `<Link>` 组件
- 使用 useRouter 钩子（客户端组件）
- 使用 redirect 功能（ 服务器组件 ）
- 使用原生 History API

#### 路由和导航的工作原理
App Router采用混合方式进行路由和导航。在服务器上，您的应用程序代码会自动按路由段进行代码拆分，这意味着导航时只会加载当前路由所需的代码。在客户端，Next.js 会预取并缓存路由段。这意味着，当用户导航到新路由时，浏览器不会重新加载页面，只有发生变化的路由段才会重新渲染，从而提升导航体验和性能。

路由和导航具备以下特性：
- 代码拆分
- Prefetching。预加载路由。默认情况下，对于动态渲染的页面，next.js不会预加载整个页面，而是从共享布局开始沿着组件树直到第一个loading.js文件才会被预加载并缓存30秒。对于静态渲染的页面，则会预加载完整的页面。
- 路由缓存
- 部分渲染：部分渲染意味着只有导航时发生变化的路线段才会在客户端重新渲染，并且任何`共享的路线段`都会被保留。
- 软导航。导航跳转不会刷新整个页面
- 前进后退导航。默认情况下，Next.js 将维护向前和向后导航的滚动位置，并重复使用路由器缓存中的路由段。


需要注意的是，Next.js并没有路由keep alive的功能。这里所说的只有共享的路线段会被保留。比如下图，当我们从home跳到商品列表页，然后再返回home时，此时只有共享的计数器的状态被保留，home页面自己的计数器重置。同时home页面的滚动位置依然被保存着。

![image](../../../imgs/route_04.jpg)

### 其他知识点

#### RootLayout和嵌套Layout的注意事项
- 只有根布局可以包含 `<html>` 和 `<body>` 标签。
- 父布局与其子布局之间无法传递数据
- 即使是静态渲染，每次访问页面，根布局都会重新渲染，而嵌套布局就不会，如下图所示：
![image](../../../imgs/route_03.jpg)