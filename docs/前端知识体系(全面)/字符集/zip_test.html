<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" />
    <title>ZIP文件协议解析</title>
</head>

<body>
    <div>
        <button id="btn">生成zip文件</button>
    </div>
    <script>
        function s2ab(s) {
            let buf = new ArrayBuffer(s.length);
            let view = new Uint8Array(buf);
            for (let i = 0; i != s.length; ++i) view[i] = s.charCodeAt(i) & 0xFF;
            return buf;
        }


     

        const bytes = [
            /*******************************local file header start****************************************/
            'PK\x03\x04',   // local file header signature     4 bytes  (0x04034b50)
            '\x0A\x00',     // version needed to extract       2 bytes
            '\x00\x00',     // general purpose bit flag        2 bytes
            '\x00\x00',     // compression method              2 bytes
            // 01010(10点) 000000(0分) 00000(0秒) => \x50\x00
            '\x00\x50',     // last mod file time              2 bytes 早上10点
            //  0101010(42) 0111(7) 11001(25) => \x54\xf9
            '\xF9\x54',     // last mod file date              2 bytes 2022年7月25日
            '\xe3\xe5\x95\xb0', // crc-32                      4 bytes
            '\x0c\x00\x00\x00', // compressed size             4 bytes
            '\x0c\x00\x00\x00', // uncompressed size           4 bytes
            // 文件名长度为9
            '\x09\x00',     // file name length                2 bytes
            // extra field length为0，说明没有extra field
            '\x00\x00',     // extra field length              2 bytes
            'Hello.txt', // file name (variable size)
            // extra field(variable size)由于没有extra field，所以file name后面就是file data
            /*******************************local file header end****************************************/
        
            /********************************file data start************************************************************/
            'Hello World\n', // file data
            /********************************file data start************************************************************/
            'PK\x01\x02', '\x14\x00', '\x0A\x00', '\x00\x00', '\x00\x00',
            '\x00\x50', '\xF9\x54', '\xe3\xe5\x95\xb0', '\x0c\x00\x00\x00',
            '\x0c\x00\x00\x00', '\x09\x00', '\x00\x00', '\x00\x00',
            '\x00\x00', '\x00\x00', '\x00\x00\x00\x00', '\x00\x00\x00\x00',
            'Hello.txt', 'PK\x05\x06', '\x00\x00', '\x00\x00', '\x01\x00',
            '\x01\x00', '\x37\x00\x00\x00', '\x33\x00\x00\x00', '\x00\x00'
        ].join('');
        btn.onclick = () => {
            const temp = s2ab(bytes)
            console.log('temp..', temp)
            let blob = new Blob([temp], { type: "application/octet-stream" });
            let url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = '123.zip';
            a.click();
            setTimeout(() => {
                // URL.revokeObjectURL(url);
            }, 10000);
        }


    </script>
</body>

</html>